<!DOCTYPE html>
<html>
<head>
<title>Sirvi Pi Monitor Dashboard</title>
<style>
  body { font-family: Arial; margin: 20px; }
  .card { padding: 15px; margin-bottom: 10px; box-shadow: 0 0 5px #aaa; border-radius: 8px; width: 350px; }
</style>
</head>
<body>

<h2>Raspberry Pi Monitor</h2>

<div class="card">
  <p>CPU: <span id="cpu">--</span></p>
  <p>Temperature: <span id="temp">--</span></p>
</div>

<div class="card">
  <p>RAM: <span id="ram">--</span></p>
  <p>Disk: <span id="disk">--</span></p>
</div>

<div class="card">
  <p><b>Fan Status: <span id="fan_state">--</span></b></p>

  <label>
    <input type="checkbox" id="fan_manual_switch">
    Manual Fan Control
  </label>
  <button id="apply">Apply</button>

  <p style="color:#666; font-size:14px;">
    Fan auto-forces ON when temperature exceeds {{ threshold }}°C.
  </p>
</div>

<script>
async function fetchStatus(){
    const res = await fetch("/status");
    const s = await res.json();

    document.getElementById("cpu").innerText = s.cpu_percent + "%";
    document.getElementById("temp").innerText = s.cpu_temp + "°C";
    document.getElementById("ram").innerText = `${s.ram_used_mb}/${s.ram_total_mb}MB`;
    document.getElementById("disk").innerText = `${s.disk_used_gb}/${s.disk_total_gb}GB`;
    document.getElementById("fan_state").innerText =
        s.fan_actual_on ? (s.fan_forced_auto ? "FAN ON (AUTO)" : "FAN ON") : "FAN OFF";

    document.getElementById("fan_manual_switch").checked = s.fan_manual_state;
}

document.getElementById("apply").onclick = async ()=>{
    const val = document.getElementById("fan_manual_switch").checked;
    await fetch("/set_fan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ manual_state: val })
    });
    fetchStatus();
};

setInterval(fetchStatus, 2000);
fetchStatus();
</script>

</body>
</html>
